<!doctype html >
<html class="no-js" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>群控</title>

    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">

    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <link rel="icon" type="image/png" th:href="@{/static/AmazeUI/i/favicon.png}">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" th:href="@{/static/AmazeUI/i/app-icon72x72@2x.png}">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
    <link rel="apple-touch-icon-precomposed" th:href="@{/static/AmazeUI/i/app-icon72x72@2x.png}">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" th:content="@{/static/AmazeUI/i/app-icon72x72@2x.png}">
    <meta name="msapplication-TileColor" content="#0e90d2">
    <link rel="stylesheet" th:href="@{/static/AmazeUI/css/amazeui.min.css}">
    <link rel="stylesheet" th:href="@{/static/AmazeUI/css/app.css}">
    <link rel="stylesheet" th:href="@{/static/range/range.css}"/>
    <!--<link th:href="@{/static/bootstrap/css/bootstrap-theme.min.css}" rel="stylesheet"/>-->
    <!--<script th:src="@{/static/jquery.js}" type="text/javascript"></script>-->
    <script th:src="@{/static/AmazeUI/js/zepto.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/AmazeUI/js/app.js}" type="text/javascript"></script>
    <script th:src="@{/static/AmazeUI/js/amazeui.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/range/range.js}" type="text/javascript"></script>
</head>
<style type="text/css">
    /*#C2000 .am-g {*/
        /*margin: 2rem 0;*/
    /*}*/

    /*.am-container {*/
    /*width: auto;*/
    /*margin: 20px;*/
    /*}*/


    h3 {
        font-weight: bold;
    }

    .title {
        text-align: center;
    }

</style>
<script type="text/javascript">
    let socket;
    $(function () {
        let url = location.host;
        console.log(location.href, url);
        $.getJSON("/getHost", function (data) {
            $.each(data, function (i, val) {
                $("#hosts").append("<option value='" + val.host_id + "'>" + val.mesh_id + "</option>");
                $("#master").append("<option value='" + val.host_id + "'>" + val.mesh_id + "</option>");
            });
        });
        if (typeof (WebSocket) == "undefined") {
            console.log("遗憾：您的浏览器不支持WebSocket");
        } else {
            socket = new WebSocket("ws://" + url + "/ws/webSocket");
            //连接打开事件
            socket.onopen = function () {
                console.log("Socket 已打开！");
            };
            //收到消息事件
            socket.onmessage = function (result) {
                console.log("type", typeof result, "receive", result.data);
            }
        }
        $("#test").click(function () {
            let cmd = $("#txt").val();
            let host = $("#hosts").val();
            $.get("/test", {"command": cmd, "host": host}, function (result) {
                console.log("cmd", cmd, "host", host, "result", result);
            });
            socket.send(cmd);
        });

        $(".host").click(function () {
            let mesh_id = $.trim($(this).val());
            let flag = $(this).is(':checked');
            $.get("/save", {"host": mesh_id, "is_control": flag}, function (result) {
                console.log("mesh_id", mesh_id, "flag", flag, "result", result);
            });
        })
        $(".master").click(function () {
            let mesh_id = $.trim($(this).val());
            let flag = $(this).is(':checked');
            $.get("/save", {"host": mesh_id, "is_master": flag}, function (result) {
                console.log("mesh_id", mesh_id, "flag", flag, "result", result);
            });
        })
        $(".bind").click(function () {
            let mesh_id = $.trim($(this).val());
            let flag = $(this).is(':checked');
            $.get("/save", {"is_master": flag}, function (result) {
                console.log("mesh_id", mesh_id, "flag", flag, "result", result);
            });
        })


        // $("#master").click(function () {
        //     let mesh_id = $.trim($(this).val());
        //     console.log("mesh_id", mesh_id);
        // })
        // $("#select").click(function () {
        //
        // })
    });

    function sendCmd(id, flag, type) {
        var code = document.getElementById("switch").innerHTML;
        let cmd;
        if (code.indexOf("ON") == 0) {
            document.getElementById("switch").innerHTML = "OFF";
            cmd = "77010315373766";
        } else if (code.indexOf("ON") == -1) {
            document.getElementById("switch").innerHTML = "ON";
            cmd = "77010315323266";
        }
        let single = $('.host').is(':checked');
        // let mesh_id;
        let status = $("#" + id).text().trim();
        console.log("flag", flag, "status", status, "single", single);
        if (flag == 'master') {
            if (single == false) {
                return;
            }
        }
        if (type) {
            $.get("/switch", {"command": cmd, "host": flag, "type": "select"}, function (result) {
                console.log("id", id, "flag", flag, "type", type, "result", result);
            })
        } else {
            $.get("/switch", {"command": cmd, "host": flag}, function (result) {
                console.log("id", id, "flag", flag, "type", type, "result", result);
            })
        }
    }

    function sendCmd2(id) {
        // let mesh_id;
        let status = $("#" + id).text().trim();
        console.log("status", status, "single");
        // flag=$('#'+id).parent('td').prev('td').text();
        let flag = $('#' + id).attr('alt');
        let checked = $('#' + id).parent('td').next('td').children('input').is(':checked');
        console.log("checked", checked);
        if (status == '开') {
            $("#" + id).val("77010315373766");
            $("#" + id).text("关")
        } else if (status == '关') {
            $("#" + id).val("77010315323266");
            $("#" + id).text("开")
        }
        $.get("/switch", {"command": $("#" + id).val(), "host": flag}, function (result) {
            console.log("result", result);
        })
    }
</script>
<body>
<header class="am-topbar am-topbar-inverse">
    <h1 class="am-topbar-brand">
        <a href="#">C2000演示DEMO</a>
    </h1>

    <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only"
            data-am-collapse="{target: '#doc-topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span
            class="am-icon-bars"></span></button>

    <div class="am-collapse am-topbar-collapse" id="doc-topbar-collapse">
        <ul class="am-nav am-nav-pills am-topbar-nav">
            <li class="am-active"><a href="#">场景一</a></li>
            <li><a href="#">场景二</a></li>
            <li><a href="#">场景三</a></li>
            <li><a href="#">场景四</a></li>
        </ul>
    </div>
</header>
<div class="main " id="#scene1">
    <div class="am-g">
        <div class="col-sm-12 col-lg-12">
            <label>All control:</label>
            <button id="switch" type="button" class="am-btn am-btn-primary  am-btn-xs"onclick="sendCmd(this.id,'all')">ON
            </button>
        </div>
    </div>
    <div class="am-g color-temperature am-margin-top-20">
        <div class="col-sm-2 col-lg-2  title-max">
            <label>色温:</label>
        </div>
        <div class="col-sm-10 col-lg-4 col-end">
            <div class="range p-r">
                <span class="show-hint">0%</span>
                <input type="range" value="0" onchange="change(this.value)">
            </div>
        </div>
    </div>
    <div class="am-g lightness am-margin-top-20">
        <div class="col-sm-2 col-lg-2 title-max">
            <label>亮度:</label>
        </div>
        <div class="col-sm-10 col-lg-4 col-end">
            <div class="range p-r">
                <span class="show-hint">0%</span>
                <input type="range" value="0" onchange="change(this.value)">
            </div>
        </div>
    </div>
</div>

<script>
    function change(val) {
        console.log(val);
    }
    $(' .color-temperature input').RangeSlider({ min: 0,   max: 100,  step: 5,  callback: change});//#snrPollInterval为input的id名
    $(' .lightness input').RangeSlider({ min: 0,   max: 100,  step: 5,  callback: change});
</script>
</body>
</html>